<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>멀티 에임 연습기</title>
    <style>
        body {
            user-select: none;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        .target {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: red;
            position: absolute;
            cursor: pointer;
        }
        #score, #timer {
            position: fixed;
            top: 10px;
            color: black;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 1000;
        }
        #score { left: 10px; }
        #timer { right: 10px; }

        #controls {
            position: fixed;
            top: 50px;
            left: 10px;
            display: flex;
            gap: 6px;
            z-index: 1000;
        }
        #controls button {
            padding: 4px 10px;
            font-size: 0.9rem;
        }

        #leaderboard {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 8px 10px;
            border-radius: 4px;
            max-width: 280px;
            font-size: 0.9rem;
            z-index: 1000;
        }
        #leaderboard h3 {
            margin: 0 0 4px 0;
            font-size: 1rem;
        }
        #leaderboard ol {
            margin: 0;
            padding-left: 18px;
        }
        #message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 16px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            display: none;
            z-index: 1000;
        }

        /* 맞췄을 때 터지는 원 이펙트 */
        .hit-effect {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 3px solid rgba(0, 255, 0, 0.8);
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: hit-burst 0.4s ease-out forwards;
            z-index: 900;
        }
        @keyframes hit-burst {
            0% {
                transform: translate(-50%, -50%) scale(0.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2.0);
                opacity: 0;
            }
        }

        /* 잘못 클릭했을 때 X 이펙트 */
        .miss-x {
            position: absolute;
            width: 24px;
            height: 24px;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 900;
            opacity: 0;
            animation: miss-pop 0.5s ease-out forwards;
        }
        .miss-x::before,
        .miss-x::after {
            content: "";
            position: absolute;
            left: 50%;
            top: 50%;
            width: 24px;
            height: 3px;
            background: rgba(255, 0, 0, 0.9);
            transform-origin: center;
        }
        .miss-x::before {
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .miss-x::after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }
        @keyframes miss-pop {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.6);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }
    </style>
</head>
<body>
<div id="score">점수: 0</div>
<div id="timer">남은 시간: 30초</div>

<div id="controls">
    <button id="endBtn">게임 종료</button>
    <button id="pauseBtn">일시정지</button>
    <button id="restartBtn">다시 시작</button>
</div>

<div id="leaderboard">
    <h3>순위표 (상위 5명)</h3>
    <ol id="rankList"></ol>
</div>
<div id="message"></div>

<script>
const BIN_URL = '...';
const API_KEY = '...';

// 점수 추가
async function addScoreToBin(name, score) {
  const getRes = await fetch(BIN_URL, {https://api.jsonbin.io/v3/b/6960665fd0ea881f405e7924
    headers: { 'X-Master-Key': $2a$10$Zc5XwU66u39U6RrTpM.r8Osz3tfGMVonD4SVE2GwTP81.d3sd/pyi }
  });
  const data = await getRes.json();          // v3에서는 { record: {...}, metadata: {...} } 형태일 수 있음
  const record = data.record || data;        // record가 있으면 그 안, 없으면 그대로 사용
  const list = Array.isArray(record.scores) ? record.scores : [];

  list.push({ name, score });

  const newRecord = { ...record, scores: list };

  await fetch(BIN_URL, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': API_KEY
    },
    body: JSON.stringify(newRecord)
  });
}

// 상위 5개
async function getTop5FromBin() {
  const res = await fetch(BIN_URL, {
    headers: { 'X-Master-Key': API_KEY }
  });
  const data = await res.json();
  const record = data.record || data;
  const list = Array.isArray(record.scores) ? record.scores : [];

  list.sort((a, b) => b.score - a.score);
  return list.slice(0, 5);
}
</script>
    // 1) 필요한 값 세팅
const BIN_URL = '여기에_JSONBin_bin_URL_붙여넣기';  // 예: https://api.jsonbin.io/v3/b/xxxxx
const API_KEY = '여기에_발급받은_X-Master-Key_붙여넣기';

// 2) 점수 추가 (게임 종료 시 호출)
async function addScoreToBin(name, score) {
  try {
    // 기존 점수 목록 가져오기
    const getRes = await fetch(BIN_URL, {
      headers: {
        'X-Master-Key': API_KEY
      }
    });
    const data = await getRes.json();
    const list = Array.isArray(data) ? data : (Array.isArray(data.record) ? data.record : []);

    // 새 점수 추가
    list.push({ name, score });

    // 다시 저장 (전체 배열 덮어쓰기)
    await fetch(BIN_URL, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': API_KEY
      },
      body: JSON.stringify(list)
    });
  } catch (err) {
    console.error('addScoreToBin error', err);
  }
}

// 3) 상위 5개 점수 가져오기
async function getTop5FromBin() {
  try {
    const res = await fetch(BIN_URL, {
      headers: {
        'X-Master-Key': API_KEY
      }
    });
    const data = await res.json();
    const list = Array.isArray(data) ? data : (Array.isArray(data.record) ? data.record : []);

    list.sort((a, b) => b.score - a.score);
    return list.slice(0, 5);
  } catch (err) {
    console.error('getTop5FromBin error', err);
    return [];
  }
}

// 4) 화면에 순위표 표시 (HTML에 <ul id="ranking-list"></ul> 있다고 가정)
async function renderRanking() {
  const scores = await getTop5FromBin();
  const listEl = document.getElementById('ranking-list');
  if (!listEl) return;

  listEl.innerHTML = '';
  scores.forEach((item, idx) => {
    const li = document.createElement('li');
    li.textContent = `${idx + 1}위 - ${item.name}: ${item.score}`;
    listEl.appendChild(li);
  });
}

</body>
</html>
